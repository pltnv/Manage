import{k as E,e as $,c as b,o as _,a as T,b as d,t as A,s as H,i as N,m as F,w as D,q as z,F as O,l as U,f as m,v as j,j as P,n as p,x as W,g as S,y as L,h as G}from"./index-KuERtz-3.js";import{u as J,D as Q}from"./PageWrapper-DHMIohQA.js";import{_ as q}from"./useLocalStorage-BdKhHayZ.js";const X={key:0,class:"task-content"},Y=["textContent"],Z={key:1,class:"task-edit"},ee={class:"edit-actions"},te={__name:"Task",props:{task:{required:!0,type:String}},emits:["click:editTask"],setup(a,{emit:e}){const o=a,t=E(!1),i=E(o.task),y=()=>{i.value=o.task,t.value=!0},I=()=>{i.value&&i.value!==o.task&&e("click:editTask",i.value.trim()),t.value=!1},g=()=>{t.value=!1};return(c,C)=>{const s=$("b-button"),n=$("b-input");return _(),b("div",{class:"task-card",draggable:!0,onDragenter:C[1]||(C[1]=H(()=>{},["prevent"])),onDragover:C[2]||(C[2]=H(()=>{},["prevent"]))},[t.value?(_(),b("div",Z,[d(n,{modelValue:i.value,"onUpdate:modelValue":C[0]||(C[0]=r=>i.value=r),type:"textarea",size:"is-small",rows:"2",autofocus:"",onKeyup:[N(I,["enter"]),N(g,["esc"])]},null,8,["modelValue","onKeyup"]),T("div",ee,[d(s,{type:"is-primary",size:"is-small","icon-right":"content-save",onClick:I}),d(s,{type:"is-text",size:"is-small","icon-right":"close",onClick:g})])])):(_(),b("div",X,[T("p",{class:"task-text",textContent:A(a.task)},null,8,Y),d(s,{type:"is-text",size:"is-small","icon-right":"pencil",class:"edit-button",onClick:y})]))],32)}}},se=q(te,[["__scopeId","data-v-e7bb6471"]]);function ae(a){const e=E(""),o=E(!1);return{newTask:e,showAddContent:o,addTask:()=>{o.value=!0},closeAddContent:()=>{o.value=!1,e.value=""},saveTask:()=>{e.value.trim()&&(a("click:saveTask",e.value.trim()),e.value="",o.value=!1)}}}const ne={class:"desk-column__header"},oe={class:"desk-column__title"},le=["textContent"],de={class:"desk-column__tasks"},ie={key:0,class:"desk-column__footer"},ce={key:1,class:"desk-column__add-task"},re={class:"desk-column__add-task__actions"},ue={__name:"Column",props:{title:{required:!0,type:String},tasks:{required:!1,type:Array,default:()=>[]},bgc:{required:!1,type:String,default:"#f5f5f5"}},emits:["update:title","click:saveTask","click:editTask","drop:task","click:deleteTask","click:deleteColumn"],setup(a,{emit:e}){const o=a,{newTask:t,showAddContent:i,addTask:y,closeAddContent:I}=ae(e),g=E(!1),c=()=>{g.value=!0},C=()=>{g.value&&r(o.title)},s=(u,l)=>{e("click:editTask",[u,l])},n=()=>{t.value.trim()&&(e("click:saveTask",t.value.trim()),t.value="",i.value=!1)},r=u=>{u.trim()&&(e("update:title",u.trim()),g.value=!1)},h=(u,l,w)=>{u.dataTransfer.setData("task",JSON.stringify(l)),u.dataTransfer.setData("oldTaskIndex",w),u.target.classList.add("dragging")},M=u=>{u.target.classList.remove("dragging")},f=(u,l)=>{const w=u.dataTransfer.getData("oldTaskIndex"),k=JSON.parse(u.dataTransfer.getData("task"));e("drop:task",[w,l,k])},x=()=>{e("click:deleteColumn")};return(u,l)=>{const w=$("b-input"),k=$("b-button"),v=$("b-dropdown-item"),R=$("b-dropdown");return _(),b("div",{draggable:!0,onDragenter:l[4]||(l[4]=H(()=>{},["prevent"])),onDragover:l[5]||(l[5]=H(()=>{},["prevent"])),class:"desk-column",style:P({"background-color":a.bgc})},[T("div",ne,[T("div",oe,[g.value?(_(),F(w,{key:1,"model-value":a.title,size:"is-small",autofocus:"",onBlur:C,"onUpdate:modelValue":l[0]||(l[0]=V=>r(V)),onKeyup:l[1]||(l[1]=N(V=>r(a.title),["enter"]))},null,8,["model-value"])):(_(),b("h3",{key:0,class:"title is-6",onDblclick:c,textContent:A(a.title)},null,40,le)),d(R,{position:"is-bottom-left",mobileModal:!1},{trigger:D(()=>[d(k,{size:"is-small","icon-right":"dots-vertical",type:"is-text"})]),default:D(()=>[d(v,{"aria-role":"listitem"},{default:D(()=>[d(k,{type:"is-text",size:"is-small","icon-left":"delete",expanded:"",onClick:x},{default:D(()=>[z(" Удалить ")]),_:1})]),_:1})]),_:1})])]),T("div",de,[(_(!0),b(O,null,U(a.tasks,(V,K)=>(_(),F(se,{key:K,draggable:!0,task:V.task,class:"task-item",onDragstart:H(B=>h(B,V,K),["stop"]),onDrop:H(B=>f(B,K),["stop"]),onDragend:l[2]||(l[2]=B=>M(B)),"onClick:editTask":B=>s(K,B)},null,8,["task","onDragstart","onDrop","onClick:editTask"]))),128))]),m(i)?(_(),b("div",ce,[d(w,{modelValue:m(t),"onUpdate:modelValue":l[3]||(l[3]=V=>j(t)?t.value=V:null),type:"textarea",size:"is-small",placeholder:"Введите текст задачи...",rows:"2",autofocus:"",onKeyup:N(n,["enter"])},null,8,["modelValue","onKeyup"]),T("div",re,[d(k,{type:"is-primary",size:"is-small",disabled:!m(t).trim(),onClick:n},{default:D(()=>[z(" Добавить ")]),_:1},8,["disabled"]),d(k,{type:"is-text",size:"is-small","icon-right":"close",onClick:m(I)},null,8,["onClick"])])])):(_(),b("div",ie,[d(k,{type:"is-text",size:"is-small","icon-left":"plus",expanded:"",onClick:m(y)},{default:D(()=>[z(A(u.$t("column.addTask")),1)]),_:1},8,["onClick"])]))],36)}}},me=q(ue,[["__scopeId","data-v-ffca5bc5"]]),ke="_icon_lv77v_12",ve="_addColumnContainer_lv77v_22",_e="_addColumnButton_lv77v_28",pe="_plusIcon_lv77v_46",Ce="_addColumnForm_lv77v_51",fe="_columnInput_lv77v_57",be="_addColumnActions_lv77v_65",Te="_saveButton_lv77v_70",ye="_cancelButton_lv77v_75",ge="_closeIcon_lv77v_84",De={icon:ke,addColumnContainer:ve,addColumnButton:_e,plusIcon:pe,addColumnForm:Ce,columnInput:fe,addColumnActions:be,saveButton:Te,cancelButton:ye,closeIcon:ge},Ie={__name:"AddColumn",emits:["add-column"],setup(a,{emit:e}){const o=E(!1),t=E(""),i=E(null),y=async()=>{var c;o.value=!0,await W(),(c=i.value)==null||c.focus()},I=()=>{t.value.trim()&&(e("add-column",t.value.trim()),t.value="",o.value=!1)},g=()=>{o.value=!1,t.value=""};return(c,C)=>{const s=$("b-input"),n=$("b-button");return _(),b("div",{class:p(c.$style.addColumnContainer)},[o.value?(_(),b("div",{key:1,class:p(c.$style.addColumnForm)},[d(s,{ref_key:"columnInput",ref:i,modelValue:t.value,"onUpdate:modelValue":C[0]||(C[0]=r=>t.value=r),class:p(c.$style.columnInput),placeholder:"Введите название колонки",autofocus:"",onKeyup:N(I,["enter"])},null,8,["modelValue","class","onKeyup"]),T("div",{class:p(c.$style.addColumnActions)},[d(n,{class:p(c.$style.saveButton),type:"is-primary",size:"is-small",onClick:I,disabled:!t.value.trim()},{default:D(()=>[z(" Добавить ")]),_:1},8,["class","disabled"]),d(n,{class:p(c.$style.cancelButton),type:"is-text",size:"is-small",onClick:g},{default:D(()=>[T("span",{class:p(c.$style.closeIcon)},"×",2)]),_:1},8,["class"])],2)],2)):(_(),b("button",{key:0,class:p(c.$style.addColumnButton),onClick:y},[T("span",{class:p(c.$style.plusIcon)},"+",2),z(" "+A(c.$t("column.addColumn")),1)],2))],2)}}},$e={$style:De},we=q(Ie,[["__cssModules",$e]]);function Ee(){const a=L(),e=J(),{boards:o}=e,t=S(()=>a.params.id),i=S(()=>{var y;return(y=a.query)==null?void 0:y.board});return{currentBoardIndex:t,boardName:i,boards:o}}function he(a,e){return{clickEditEmit:(s,n)=>{const[r,h]=n;a.editTask({boardIndex:e.value,deskIndex:s,taskIndex:r,newText:h})},saveTaskEmit:(s,n)=>{n&&a.addTask({boardIndex:e.value,deskIndex:s,taskText:n})},editTitleEmit:s=>{const[n,r]=s;a.renameDesk({boardIndex:e.value,oldTitle:r,newTitle:n})},deleteTaskEmit:(s,n)=>{a.removeTask({boardId:e.value,deskIndex:s,taskIndex:n})},dropTaskHandler:(s,n)=>{const[r,h,M]=s;a.moveTask({boardIndex:e.value,newDeskIndex:n,oldTaskIndex:r,task:M,newTaskIndex:h})},dropHandler:(s,n)=>{try{const r=s.dataTransfer.getData("deskOldIndex");a.moveDesk({boardIndex:e.value,newDeskIndex:n,oldDeskIndex:r})}catch(r){console.warn(r)}},dragHandler:(s,n)=>{s.dataTransfer.setData("deskOldIndex",n)},deleteColumn:s=>{a.removeDesk({boardIndex:e.value,deskIndex:s})}}}const xe="_icon_mrcf7_12",Ve="_desksHeader_mrcf7_22",Be="_headerContent_mrcf7_29",Ae="_boardTitle_mrcf7_33",ze="_breadcrumb_mrcf7_39",He="_deskViewMain_mrcf7_43",Me="_desks_mrcf7_22",Ne={icon:xe,desksHeader:Ve,headerContent:Be,boardTitle:Ae,breadcrumb:ze,deskViewMain:He,desks:Me},Ke=["textContent"],qe={__name:"BoardView",setup(a){L();const e=J(),{currentBoardIndex:o,boardName:t,boards:i}=Ee(),{clickEditEmit:y,saveTaskEmit:I,editTitleEmit:g,deleteTaskEmit:c,dropTaskHandler:C,dropHandler:s,dragHandler:n,deleteColumn:r}=he(e,o),h=f=>{e.addDesk(o.value,f)},M=S(()=>{var f,x;return(x=(f=i[o.value])==null?void 0:f.desks)==null?void 0:x.length});return(f,x)=>{const u=$("b-breadcrumb-item"),l=$("b-breadcrumb");return _(),F(Q,null,{default:D(()=>[T("div",{class:p(f.$style.desksHeader)},[T("div",{class:p(f.$style.headerContent)},[T("h1",{class:p(f.$style.boardTitle),textContent:A(m(t))},null,10,Ke),d(l,{class:p(f.$style.breadcrumb),align:"is-left",size:"is-small"},{default:D(()=>[d(u,{tag:"router-link",to:"/boards"},{default:D(()=>[z(A(f.$t("boards.title")),1)]),_:1}),d(u,{tag:"router-link",to:"/",active:""},{default:D(()=>[z(A(m(t)),1)]),_:1})]),_:1},8,["class"])],2)],2),T("div",{class:p(f.$style.deskViewMain)},[M.value?(_(!0),b(O,{key:0},U(m(i)[m(o)].desks,(w,k)=>(_(),b("div",{key:k,class:p(f.$style.desks)},[d(me,{title:w.title,tasks:w.tasks,"onClick:editTitle":x[0]||(x[0]=v=>m(g)(v)),"onClick:editTask":v=>m(y)(k,v),"onClick:saveTask":v=>m(I)(k,v),"onClick:deleteTask":v=>m(c)(k,v),"onClick:deleteColumn":v=>m(r)(k),"onDrop:task":v=>m(C)(v,k),onDrop:v=>m(s)(v,k),onDragstart:v=>m(n)(v,k)},null,8,["title","tasks","onClick:editTask","onClick:saveTask","onClick:deleteTask","onClick:deleteColumn","onDrop:task","onDrop","onDragstart"])],2))),128)):G("",!0),d(we,{onAddColumn:h})],2)]),_:1})}}},Fe={$style:Ne},Le=q(qe,[["__cssModules",Fe]]);export{Le as default};
